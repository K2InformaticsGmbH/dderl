<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>SlickGrid in Dialog</title>

    <link rel='stylesheet' href='https://fonts.googleapis.com/css?family=Droid+Sans+Mono' type='text/css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.0/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="https://raw.github.com/k2informatics/SlickGrid/master/slick.grid.css" type="text/css"/>
    <link rel="stylesheet" href="https://raw.github.com/k2informatics/SlickGrid/master/controls/slick.columnpicker.css" type="text/css"/>
    <link rel="stylesheet" href="../static/styles/dderl.css" type="text/css"/>
</head>

<body>
    <span id='txtlen' style='display:none;'></span>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.0/jquery-ui.min.js"></script>

    <script src="../static/slickgrid/lib/jquery.event.drag-2.0.min.js"></script>
    <script src="../static/slickgrid/slick.core.js"></script>
    <script src="../static/slickgrid/slick.grid.js"></script>
    <script src="../static/slickgrid/slick.formatters.js"></script>
    <script src="../static/slickgrid/slick.editors.js"></script>
    <script src="../static/slickgrid/slick.dataview.js"></script>
    <script src="../static/slickgrid/plugins/slick.cellrangedecorator.js"></script>
    <script src="../static/slickgrid/plugins/slick.cellrangeselector.js"></script>
    <!-- script src="../static/slickgrid/plugins/slick.cellselectionmodel.js"></script>
    <script src="../static/slickgrid/plugins/slick.rowselectionmodel.js"></script -->
    <script src="../static/slickgrid/plugins/slick.cellrowcolselectionmodel.js"></script>
    <script src="../static/slickgrid/controls/slick.columnpicker.js"></script>
    <!-- script src="../static/slickgrid/plugins/slick.cellcopymanager.js"></script -->

    <script language="javascript">
        var TOOLBAR_HEIGHT = 20;
        $(document).ready(function()
        {
            show_dlg();
            var columns = new Array();
            for(var cl = 10; cl > 0; --cl)
               columns[columns.length] = ("col" + cl);
            columns = prepareColumns(columns);
            loadTable($('#body'), columns);
        });

        function show_dlg() {
            var dlg = $('<div id="sample" style="margin:0; padding:0;"></div>').appendTo(document.body);

            var table = $('<div id="body"></div>')
            .css('position', 'absolute')
            .css('top', '0')
            .css('left', '0')
            .css('right', '0')
            .css('bottom', TOOLBAR_HEIGHT+'px')
            .css('overflow', 'auto')
            .css('border-style', 'solid')
            .css('border-width', '1px')
            .css('border-color', 'lightblue')
            .appendTo(dlg);

            var footer = $('<div></div>')
            .css('height', TOOLBAR_HEIGHT+'px')
            .css('position', 'absolute')
            //.css('top', 'auto')
            .css('left', '0')
            .css('right', '0')
            .css('bottom', '0')
            .css('overflow', 'hidden')
            .appendTo(dlg);

            dlg.dialog({
                autoOpen: false,
                height: 200,
                width: 200,
                minHeight: 200,
                resizable: true,
                modal: false,
                title: "Sample Dialog",
                canMinimize:true,
                canMaximize:true,
                closeOnEscape: false,
                open: function(e,ui) {},
                focus: function(e,ui) {},
                close: function() {
                    dlg.dialog('destroy');
                    dlg.remove();
                }
            })
            .bind("dialogresize", function(event, ui) 
            {
                table.width(dlg.width()-2);
                table.height(dlg.height()-TOOLBAR_HEIGHT-2);
                //footer.css('top', dlg.height()-TOOLBAR_HEIGHT-10);
                if(undefined != table.data('grid')) {
                    var grid = table.data('grid');
                    var data = grid.getData();
                    grid.setData(data);
                    grid.updateRowCount();
                    grid.render();
                    grid.resizeCanvas();
                }
            })
            .dialog("open");



            var rld = gen_btn_elm({ txt : 'Reload'                                              // Refresh
                                  , icn : 'ui-icon-arrowrefresh-1-e'
                                  , clk : function() {} });
            var m2f = gen_btn_elm({ txt : 'Move to first'                                       // |<
                                  , icn : 'ui-icon-seek-first'
                                  , clk : function() {} });
            var j2p = gen_btn_elm({ txt : 'Jump to previous page'                               // <<
                                  , icn : 'ui-icon-seek-prev'
                                  , clk : function() {} });
            var rjtb = { elm : $('<input type="text" size=10 class="download_incomplete">')     // RowJumpTextBox
                             .css('margin-bottom', '0px')
                             .css('height', (TOOLBAR_HEIGHT-5)+'px')
                       , icn : null
                       , clk : function() { $(this).select(); }};
            var m2np = gen_btn_elm({ txt : 'Next page', icn : 'ui-icon-play'                    // >
                                   , clk : function() {} })
            var m2e = gen_btn_elm({ txt : 'Move to end', icn : 'ui-icon-seek-end'               // >|
                                  , clk : function() {} });
            var m2et = gen_btn_elm({ txt : 'Move to end then Tail', icn : 'ui-icon-fetch-tail'  // Move to end then Tail
                                   , clk : function() {} });
            var s2et = gen_btn_elm({ txt : 'Skip to end and Tail', icn : 'ui-icon-fetch-only'   // Skip to end and Tail
                                   , clk : function() {} });
            var cmt = gen_btn_elm({ txt : 'Commit changes', icn : 'ui-icon-check'              // Commit
                                  , clk : function() {} });
            var dis = gen_btn_elm({ txt : 'Discard changes', icn : 'ui-icon-close'             // Discard
                                  , clk : function() {} });
            var j2np = gen_btn_elm({ txt : 'Jump to next page', icn : 'ui-icon-seek-next'      // >>
                                   , clk : function() {
                                        cmt.elm.toggle();
                                        dis.elm.toggle();
                                        m2e.elm.toggle();
                                        m2et.elm.toggle();
                                        s2et.elm.toggle();
                                    }
                                   });

            append_to_footer(footer, rld);
            append_to_footer(footer, m2f);
            append_to_footer(footer, j2p);
            append_to_footer(footer, rjtb);
            append_to_footer(footer, m2np);
            append_to_footer(footer, j2np);
            append_to_footer(footer, m2e);
            append_to_footer(footer, m2et);
            append_to_footer(footer, s2et);
            append_to_footer(footer, cmt);
            append_to_footer(footer, dis);

            footer.buttonset().css('height', TOOLBAR_HEIGHT+'px');

            cmt.elm.hide();
            dis.elm.hide();
        }

        function gen_btn_elm(itm) {
        itm['elm'] =
                $('<button>'+itm.txt+'</button>')
                .button({icons: {primary: itm.icn}, text: false})
                .css('height', (TOOLBAR_HEIGHT) +'px')
                .click(itm.clk);
            return itm;
        }

        function append_to_footer(footer, itm) {
            footer.append(itm.elm);
        }

        var MAX_ROW_WIDTH = 1000;
        function loadTable(node, columns)
        {
            var node_id = '#' + node.attr('id');
            var options = {editable: true,
                       enableAddRow: true,
                enableColumnReorder: true,
               enableCellNavigation: true,
                 asyncEditorLoading: false,
                           autoEdit: false,
                             zIndex: 1300,
                          rowHeight: 20};
        
            var grid = new Slick.Grid(node_id, [], columns, options);
            grid.setSelectionModel(new Slick.CellRowColSelectionModel());

            var fntFamily = $(node_id).find("*").css('font-family');
            var fntSize   = $(node_id).find("*").css('font-size');
            $('#txtlen')
                .css('font-family', fntFamily)
                .css('font-size', fntSize);

            var data = new Array();
            var c = grid.getColumns();
            for(var i=0; i < 100; ++i) {
                var row = {};
                row['id'] = i;
                for(var j=1; j < columns.length; ++j) {
                    var str = randomString(j*5);
                    var fieldWidth = $('#txtlen').text(str).width()+25;
                    if(c[j].width < fieldWidth) {
                        c[j].width = fieldWidth;
                        if (c[j].width > MAX_ROW_WIDTH)
                            c[j].width = MAX_ROW_WIDTH;
                    }
                    //console.log(' - ' + fieldWidth);
                    row[columns[j].field] = str;
                }
                data[data.length] = row;
            }

            grid.setColumns(c);
            grid.setData(data);
            grid.updateRowCount();
            grid.render();

            node.data('grid',grid);
        }

        function randomString(idx) {
        	var chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz";
        	var string_length = 8;
        	var randomstring = '';
        	for (var i=0; i<Math.floor((Math.random()*idx)+1); i++) {
        		var rnum = Math.floor(Math.random() * chars.length);
        		randomstring += chars.substring(rnum,rnum+1);
        	}
        	return randomstring;
        }
        
        function prepareColumns(headers) {
            // Column Data
            var header = new Array();
            header[header.length] = {  id: "sel",
                                     name: "",
                                    field: "id",
                                 behavior: "select",
                                 cssClass: "cell-selection",
                                 minWidth: 35,
                                    width: 35,
                      cannotTriggerInsert: true,
                                resizable: true,
                                 sortable: false,
                               selectable: false};
            for (i=0;i<headers.length;++i) {
                var fldid = headers[i];
                if(fldid == fldid.toLowerCase() && fldid == 'id')
                    fldid = ('_'+fldid.toLowerCase());
                header[header.length] = {  id: fldid,
                                         name: headers[i],
                                        field: fldid,
                                       editor: Slick.Editors.Text,
                                     minWidth: 20,
                                        width: 10 * headers[i].length,
                                    resizable: true,
                                     sortable: false,
                                   selectable: true};
            }
            return header;
        }

    </script>
</body>

</html>

